---
globs: templates/*.html
---

# Halo 主题开发规则

## 版本信息
- **Halo**: v2.21+
- **主题 API**: v1alpha1

## 核心配置文件

### 主题信息配置
[theme.yaml](mdc:theme.yaml) 定义主题的基本信息：
```yaml
apiVersion: theme.halo.run/v1alpha1
kind: Theme
metadata:
  name: theme-sky-blog
spec:
  displayName: Sky Blog Theme
  author:
    name: sky
    website: https://github.com/sky121666
  description: 基于Vite、Tailwind CSS、DaisyUI和Alpine.js的现代化Halo主题
  version: "1.0.0"
  requires: "2.0.0"
  settingName: "theme-sky-blog-setting"
  configMapName: "theme-sky-blog-configMap"
```

### 主题设置配置
[settings.yaml](mdc:settings.yaml) 定义主题的设置项

## 模板文件结构

### 核心模板
- **首页模板**: [templates/index.html](mdc:templates/index.html)
- **文章页模板**: [templates/post.html](mdc:templates/post.html)
- **布局模板**: [templates/modules/layout.html](mdc:templates/modules/layout.html)

### 静态资源
构建后的静态资源会自动输出到 `templates/assets/` 目录：
- `templates/assets/css/` - 样式文件
- `templates/assets/js/` - JavaScript 文件
- `templates/assets/fonts/` - 字体文件

## Thymeleaf 模板语法

### 基本语法
```html
<!-- 变量输出 -->
<h1 th:text="${post.title}">文章标题</h1>

<!-- 条件判断 -->
<div th:if="${post.thumbnail}" class="post-thumbnail">
  <img th:src="${post.thumbnail}" alt="缩略图">
</div>

<!-- 循环 -->
<div th:each="post : ${posts}" class="post-item">
  <h2 th:text="${post.title}">标题</h2>
  <p th:text="${post.excerpt}">摘要</p>
</div>
```

### 常用对象
```html
<!-- 站点信息 -->
<title th:text="${site.title}">站点标题</title>

<!-- 主题配置 -->
<div th:if="${theme.config.showSidebar}">
  <!-- 侧边栏内容 -->
</div>

<!-- 用户信息 -->
<div th:if="${user}">
  <span th:text="${user.displayName}">用户名</span>
</div>
```

## 资源引用

### CSS 样式文件
```html
<!-- 引用构建后的 CSS 文件 -->
<link th:href="@{/assets/css/main.css}" rel="stylesheet">
```

### JavaScript 文件
```html
<!-- 引用构建后的 JS 文件 -->
<script th:src="@{/assets/js/main.js}"></script>
```

### 图标字体
```html
<!-- 引用字体文件 -->
<link th:href="@{/assets/fonts/icons.css}" rel="stylesheet">
```

## 布局组织

### 公共布局
```html
<!-- templates/modules/layout.html -->
<!DOCTYPE html>
<html lang="zh-CN" th:data-theme="${theme.config.defaultTheme}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title th:text="${site.title}">站点标题</title>
  <link th:href="@{/assets/css/main.css}" rel="stylesheet">
</head>
<body>
  <header th:replace="~{modules/header :: header}"></header>
  <main th:replace="~{${template} :: main}"></main>
  <footer th:replace="~{modules/footer :: footer}"></footer>
  <script th:src="@{/assets/js/main.js}"></script>
</body>
</html>
```

### 片段复用
```html
<!-- 定义片段 -->
<div th:fragment="post-card" class="card bg-base-100 shadow-xl">
  <div class="card-body">
    <h2 class="card-title" th:text="${post.title}">标题</h2>
    <p th:text="${post.excerpt}">摘要</p>
    <div class="card-actions justify-end">
      <a th:href="@{/posts/{slug}(slug=${post.slug})}" class="btn btn-primary">阅读更多</a>
    </div>
  </div>
</div>

<!-- 使用片段 -->
<div th:each="post : ${posts}" th:replace="~{fragments/post-card :: post-card}"></div>
```

## 数据绑定

### 文章数据
```html
<!-- 文章基本信息 -->
<h1 th:text="${post.title}">文章标题</h1>
<time th:text="${#temporals.format(post.publishTime, 'yyyy-MM-dd')}">发布时间</time>
<div class="post-content" th:utext="${post.content}">文章内容</div>

<!-- 文章元数据 -->
<div class="post-meta">
  <span th:text="${post.categories[0].displayName}">分类</span>
  <div th:each="tag : ${post.tags}" class="badge badge-outline">
    <span th:text="${tag.displayName}">标签</span>
  </div>
</div>
```

### 分页数据
```html
<!-- 分页信息 -->
<div class="pagination">
  <a th:if="${posts.hasPrevious}" 
     th:href="@{/(page=${posts.number - 1})}" 
     class="btn btn-outline">上一页</a>
  
  <span th:text="${posts.number + 1} + ' / ' + ${posts.totalPages}">页码</span>
  
  <a th:if="${posts.hasNext}" 
     th:href="@{/(page=${posts.number + 1})}" 
     class="btn btn-outline">下一页</a>
</div>
```

## 主题设置

### 配置读取
```html
<!-- 读取主题配置 -->
<div th:if="${theme.config.showSidebar}" class="sidebar">
  <!-- 侧边栏内容 -->
</div>

<!-- 配置默认值 -->
<div th:class="${theme.config.layout ?: 'default'}" class="layout">
  <!-- 布局内容 -->
</div>
```

### 条件渲染
```html
<!-- 根据配置显示不同内容 -->
<div th:switch="${theme.config.headerStyle}">
  <nav th:case="'minimal'" class="navbar-minimal">最小化导航</nav>
  <nav th:case="'full'" class="navbar-full">完整导航</nav>
  <nav th:case="*" class="navbar-default">默认导航</nav>
</div>
```

## 最佳实践

### 1. 响应式设计
```html
<!-- 使用 Tailwind CSS 的响应式类 -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  <div th:each="post : ${posts}" class="card bg-base-100 shadow-xl">
    <!-- 文章卡片 -->
  </div>
</div>
```

### 2. 性能优化
```html
<!-- 图片懒加载 -->
<img th:src="${post.thumbnail}" 
     loading="lazy" 
     alt="缩略图"
     class="w-full h-48 object-cover">

<!-- 预加载关键资源 -->
<link rel="preload" th:href="@{/assets/css/main.css}" as="style">
```

### 3. SEO 优化
```html
<!-- 结构化数据 -->
<script type="application/ld+json" th:inline="javascript">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "[[${post.title}]]",
  "datePublished": "[[${post.publishTime}]]",
  "author": {
    "@type": "Person",
    "name": "[[${post.owner.displayName}]]"
  }
}
</script>

<!-- Open Graph 标签 -->
<meta property="og:title" th:content="${post.title}">
<meta property="og:description" th:content="${post.excerpt}">
<meta property="og:image" th:content="${post.thumbnail}">
```

### 4. 多语言支持
```html
<!-- 使用消息国际化 -->
<button class="btn btn-primary" th:text="#{button.readmore}">阅读更多</button>
<time th:text="${#temporals.format(post.publishTime, #{date.format})}">时间</time>
```
