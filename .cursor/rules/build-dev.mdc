---
alwaysApply: true
---

# 构建和开发规则

## 包管理器
- **推荐使用**: pnpm v10.6.5+
- **Node.js**: v20+

## 开发命令

### 核心命令
```bash
# 开发模式 - 启动文件监听，自动构建
pnpm dev

# 完整构建 - 编译 TypeScript，构建资源，打包主题
pnpm build

# 仅构建 - 编译和构建，不打包
pnpm build-only

# 代码检查
pnpm lint

# 代码格式化
pnpm prettier
```

### 构建流程
1. **TypeScript 编译**: `tsc` 检查类型并编译
2. **Vite 构建**: `vite build` 构建前端资源
3. **主题打包**: `theme-package` 打包成 `.halo` 文件

## 构建配置

### Vite 配置
基于 [vite.config.ts](mdc:vite.config.ts)：
- **入口文件**: [src/main.js](mdc:src/main.js)
- **输出目录**: `templates/assets/`
- **文件命名**: 
  - JavaScript: `js/[name].js`
  - CSS: `css/[name].css`
  - 其他资源: `assets/[name][extname]`

### 资源处理
- **禁用内联**: `assetsInlineLimit: 0` 确保所有资源都作为独立文件输出
- **代码分割**: 支持按需加载
- **Source Maps**: 开发环境生成 source maps

## 代码质量

### ESLint 配置
基于 [eslint.config.js](mdc:eslint.config.js)：
- 检查 `.js`, `.cjs`, `.mjs`, `.ts`, `.cts`, `.mts` 文件
- 集成 TypeScript 和 Prettier 规则
- 支持现代 JavaScript 特性

### Prettier 配置
基于 [prettier.config.js](mdc:prettier.config.js)：
- 格式化 TypeScript、JSON、YAML、HTML 文件
- 集成 Tailwind CSS 类排序
- 120 字符行宽
- 2 空格缩进

### Git Hooks
使用 Husky 和 lint-staged：
- **pre-commit**: 自动格式化暂存文件
- **提交前检查**: 确保代码质量

## 开发工作流

### 1. 启动开发环境
```bash
# 安装依赖
pnpm install

# 启动开发模式
pnpm dev
```

### 2. 开发过程
- 在 `src/` 目录编写前端代码
- 在 `templates/` 目录编写模板文件
- 保存文件时自动构建和更新

### 3. 代码检查
```bash
# 运行 ESLint
pnpm lint

# 修复可自动修复的问题
pnpm lint --fix

# 格式化代码
pnpm prettier
```

### 4. 构建发布
```bash
# 完整构建和打包
pnpm build

# 生成的 .halo 文件位于项目根目录
```

## 文件监听
开发模式下，以下文件变化会触发重新构建：
- `src/**/*` - 前端源码
- `templates/**/*` - 模板文件
- `package.json` - 依赖变化
- 配置文件变化

## 调试支持

### Source Maps
- **开发环境**: 生成详细的 source maps
- **生产环境**: 可选择性启用

### 浏览器调试
```typescript
// 在代码中添加断点
debugger;

// 使用 console 调试
console.log('Debug info:', data);
console.error('Error:', error);
```

### 网络调试
```bash
# 检查构建产物
ls -la templates/assets/

# 查看文件大小
du -h templates/assets/*
```

## 性能优化

### 构建优化
- **代码分割**: 按需加载模块
- **Tree Shaking**: 移除未使用代码
- **压缩**: 生产环境自动压缩

### 开发优化
- **热更新**: 快速的文件变化检测
- **增量构建**: 只构建变化的文件
- **并行处理**: 多核心构建支持

## 常见问题

### 构建失败
1. **检查 TypeScript 类型错误**
   ```bash
   npx tsc --noEmit
   ```

2. **清理缓存**
   ```bash
   rm -rf node_modules/.cache
   pnpm install
   ```

3. **检查依赖版本**
   ```bash
   pnpm outdated
   ```

### 样式问题
1. **检查 Tailwind CSS 配置**
2. **确认 PostCSS 处理**
3. **验证 DaisyUI 组件**

### 热更新不工作
1. **检查文件路径**
2. **确认 Vite 配置**
3. **重启开发服务器**

## 部署准备

### 构建检查
```bash
# 完整构建
pnpm build

# 检查生成的文件
ls -la *.halo

# 验证模板文件
ls -la templates/assets/
```

### 文件大小检查
```bash
# 检查 JavaScript 文件大小
ls -lh templates/assets/js/

# 检查 CSS 文件大小
ls -lh templates/assets/css/
```

### 上传到 Halo
1. 登录 Halo 后台
2. 进入主题管理
3. 上传生成的 `.halo` 文件
4. 启用并配置主题
