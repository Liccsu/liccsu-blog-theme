<!-- ========================================== -->
<!--    Gateway Fragments - Password Reset     -->
<!--    发送重置邮件表单 (Premium Style)        -->
<!-- ========================================== -->

<th:block th:fragment="form">
  <!-- 已发送状态 -->
  <form th:if="${sent}" method="get" action="/login" class="space-y-5">
    <div class="bg-success/10 border-success/20 text-success flex items-start gap-3 rounded-xl border p-5 text-sm">
      <span class="icon-[heroicons--check-circle] h-6 w-6 shrink-0"></span>
      <div>
        <p class="mb-1 font-semibold">邮件发送成功！</p>
        <p class="text-success/70">请检查您的收件箱，点击邮件中的链接重置密码。如未收到，请检查垃圾邮件文件夹。</p>
      </div>
    </div>
    <div class="pt-2">
      <button type="submit" class="premium-btn">返回登录</button>
    </div>
  </form>

  <!-- 发送表单 -->
  <form th:unless="${sent}" class="space-y-5" th:action="@{/password-reset/email}" method="post" th:object="${form}">
    <!-- 错误提示 -->
    <div
      class="bg-error/10 border-error/20 text-error flex items-start gap-3 rounded-xl border p-4 text-sm"
      role="alert"
      th:if="${param.error.size() > 0}"
    >
      <span class="icon-[heroicons--exclamation-circle] mt-0.5 h-5 w-5 shrink-0"></span>
      <span th:if="${param.error[0] == 'invalid_reset_token'}">重置链接无效或已过期，请重新发送</span>
    </div>
    <div
      class="bg-error/10 border-error/20 text-error flex items-start gap-3 rounded-xl border p-4 text-sm"
      role="alert"
      th:if="${error}"
    >
      <span class="icon-[heroicons--exclamation-circle] mt-0.5 h-5 w-5 shrink-0"></span>
      <span th:if="${error == 'rate_limit_exceeded'}">请求过于频繁，请稍后再试</span>
    </div>

    <!-- 邮箱输入 -->
    <div class="space-y-2">
      <label for="email" class="text-base-content/70 block text-sm font-medium">邮箱地址</label>
      <input
        type="email"
        id="email"
        name="email"
        placeholder="请输入注册时使用的邮箱"
        autofocus
        required
        th:field="*{email}"
        class="premium-input"
      />
      <p class="text-error text-xs" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></p>
    </div>

    <!-- Altcha 验证码 -->
    <div halo:captcha class="w-full"></div>

    <!-- 提交按钮 -->
    <div class="pt-2">
      <button type="submit" class="premium-btn">发送重置链接</button>
    </div>
  </form>
</th:block>
