<!-- ========================================== -->
<!--    Gateway Fragments - Password Reset     -->
<!--    重置密码表单 (Premium Style)            -->
<!-- ========================================== -->

<form
  th:fragment="form"
  class="space-y-5"
  th:action="@{/password-reset/email/{resetToken}(resetToken=${resetToken})}"
  method="post"
  th:object="${form}"
>
  <!-- 错误提示 -->
  <div
    class="bg-error/10 border-error/20 text-error flex items-start gap-3 rounded-xl border p-4 text-sm"
    role="alert"
    th:if="${error}"
  >
    <span class="icon-[heroicons--exclamation-circle] mt-0.5 h-5 w-5 shrink-0"></span>
    <span th:if="${error == 'rate_limit_exceeded'}">请求过于频繁，请稍后再试</span>
  </div>

  <!-- 新密码 -->
  <div class="space-y-2">
    <label for="password" class="text-base-content/70 block text-sm font-medium">新密码</label>
    <div class="toggle-password-display-flag relative">
      <input
        id="password"
        name="password"
        type="password"
        placeholder="至少 5 个字符"
        autocomplete="off"
        required
        minlength="5"
        maxlength="257"
        class="premium-input pr-12"
      />
      <div
        class="toggle-password-button text-base-content/40 hover:text-base-content absolute top-1/2 right-4 -translate-y-1/2 cursor-pointer transition-colors"
      >
        <svg class="password-hidden-icon h-5 w-5" style="display: none" viewBox="0 0 24 24">
          <path
            fill="currentColor"
            d="M12 3c5.392 0 9.878 3.88 10.819 9c-.94 5.12-5.427 9-10.819 9c-5.392 0-9.878-3.88-10.818-9C2.122 6.88 6.608 3 12 3Zm0 16a9.005 9.005 0 0 0 8.778-7a9.005 9.005 0 0 0-17.555 0A9.005 9.005 0 0 0 12 19Zm0-2.5a4.5 4.5 0 1 1 0-9a4.5 4.5 0 0 1 0 9Zm0-2a2.5 2.5 0 1 0 0-5a2.5 2.5 0 0 0 0 5Z"
          ></path>
        </svg>
        <svg class="password-display-icon h-5 w-5" viewBox="0 0 24 24">
          <path
            fill="currentColor"
            d="M17.883 19.297A10.949 10.949 0 0 1 12 21c-5.392 0-9.878-3.88-10.818-9A10.982 10.982 0 0 1 4.52 5.935L1.394 2.808l1.414-1.414l19.799 19.798l-1.414 1.415l-3.31-3.31ZM5.936 7.35A8.965 8.965 0 0 0 3.223 12a9.005 9.005 0 0 0 13.201 5.838l-2.028-2.028A4.5 4.5 0 0 1 8.19 9.604L5.936 7.35Zm6.978 6.978l-3.242-3.241a2.5 2.5 0 0 0 3.241 3.241Zm7.893 2.265l-1.431-1.431A8.935 8.935 0 0 0 20.778 12A9.005 9.005 0 0 0 9.552 5.338L7.974 3.76C9.221 3.27 10.58 3 12 3c5.392 0 9.878 3.88 10.819 9a10.947 10.947 0 0 1-2.012 4.593Zm-9.084-9.084a4.5 4.5 0 0 1 4.769 4.769l-4.77-4.77Z"
          ></path>
        </svg>
      </div>
    </div>
    <p class="text-error text-xs" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></p>
  </div>

  <!-- 确认密码 -->
  <div class="space-y-2">
    <label for="confirmPassword" class="text-base-content/70 block text-sm font-medium">确认密码</label>
    <div class="toggle-password-display-flag relative">
      <input
        id="confirmPassword"
        name="confirmPassword"
        type="password"
        placeholder="再次输入新密码"
        autocomplete="off"
        required
        minlength="5"
        maxlength="257"
        class="premium-input pr-12"
      />
      <div
        class="toggle-password-button text-base-content/40 hover:text-base-content absolute top-1/2 right-4 -translate-y-1/2 cursor-pointer transition-colors"
      >
        <svg class="password-hidden-icon h-5 w-5" style="display: none" viewBox="0 0 24 24">
          <path
            fill="currentColor"
            d="M12 3c5.392 0 9.878 3.88 10.819 9c-.94 5.12-5.427 9-10.819 9c-5.392 0-9.878-3.88-10.818-9C2.122 6.88 6.608 3 12 3Zm0 16a9.005 9.005 0 0 0 8.778-7a9.005 9.005 0 0 0-17.555 0A9.005 9.005 0 0 0 12 19Zm0-2.5a4.5 4.5 0 1 1 0-9a4.5 4.5 0 0 1 0 9Zm0-2a2.5 2.5 0 1 0 0-5a2.5 2.5 0 0 0 0 5Z"
          ></path>
        </svg>
        <svg class="password-display-icon h-5 w-5" viewBox="0 0 24 24">
          <path
            fill="currentColor"
            d="M17.883 19.297A10.949 10.949 0 0 1 12 21c-5.392 0-9.878-3.88-10.818-9A10.982 10.982 0 0 1 4.52 5.935L1.394 2.808l1.414-1.414l19.799 19.798l-1.414 1.415l-3.31-3.31ZM5.936 7.35A8.965 8.965 0 0 0 3.223 12a9.005 9.005 0 0 0 13.201 5.838l-2.028-2.028A4.5 4.5 0 0 1 8.19 9.604L5.936 7.35Zm6.978 6.978l-3.242-3.241a2.5 2.5 0 0 0 3.241 3.241Zm7.893 2.265l-1.431-1.431A8.935 8.935 0 0 0 20.778 12A9.005 9.005 0 0 0 9.552 5.338L7.974 3.76C9.221 3.27 10.58 3 12 3c5.392 0 9.878 3.88 10.819 9a10.947 10.947 0 0 1-2.012 4.593Zm-9.084-9.084a4.5 4.5 0 0 1 4.769 4.769l-4.77-4.77Z"
          ></path>
        </svg>
      </div>
    </div>
    <p class="text-error text-xs" th:if="${#fields.hasErrors('confirmPassword')}" th:errors="*{confirmPassword}"></p>
  </div>

  <!-- 提示信息 -->
  <div class="bg-info/10 border-info/20 text-info flex items-start gap-3 rounded-xl border p-4 text-sm">
    <span class="icon-[heroicons--information-circle] mt-0.5 h-5 w-5 shrink-0"></span>
    <span>密码长度至少 5 个字符，建议使用字母、数字和符号的组合</span>
  </div>

  <!-- Altcha 验证码 -->
  <div halo:captcha class="w-full"></div>

  <!-- 提交按钮 -->
  <div class="pt-2">
    <button type="submit" class="premium-btn">重置密码</button>
  </div>

  <!-- 密码确认脚本 -->
  <script th:inline="javascript">
    document.addEventListener("DOMContentLoaded", function () {
      setupPasswordConfirmation("password", "confirmPassword");
    });
  </script>
</form>
