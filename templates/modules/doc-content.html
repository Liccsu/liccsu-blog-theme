<!-- 文档内容页 - 现代全宽文档风格 -->
<div th:fragment="content" class="doc-layout">
  <!-- 左侧文档树 - 固定定位 -->
  <aside class="doc-sidebar hidden lg:block">
    <div class="doc-sidebar-inner scrollbar-thin">
      <!-- 版本选择器 - 仅当有多个版本时显示 -->
      <th:block th:if="${#lists.size(versions) > 1}">
        <div class="doc-version-selector">
          <button class="doc-version-btn" onclick="this.nextElementSibling.classList.toggle('show')" type="button">
            <span class="flex items-center gap-2">
              <span class="icon-[heroicons--tag] h-4 w-4"></span>
              <span th:text="${currentVersion.spec.slug}">版本</span>
            </span>
            <span class="icon-[heroicons--chevron-down] h-4 w-4"></span>
          </button>
          <div class="doc-version-dropdown">
            <a
              th:each="version : ${versions}"
              th:href="${version.status.permalink}"
              class="doc-version-item"
              th:classappend="${version.metadata.name == currentVersion.metadata.name} ? 'active' : ''"
            >
              <span th:text="${version.spec.slug}">版本名</span>
            </a>
          </div>
        </div>
      </th:block>

      <!-- 语言选择器 - 仅当有多个语言时显示 -->
      <th:block th:if="${#lists.size(languages) > 1}">
        <div class="doc-version-selector">
          <button class="doc-version-btn" onclick="this.nextElementSibling.classList.toggle('show')" type="button">
            <span class="flex items-center gap-2">
              <span class="icon-[heroicons--language] h-4 w-4"></span>
              <span th:if="${currentLanguage != null}" th:text="${currentLanguage.label}">语言</span>
              <span th:unless="${currentLanguage != null}">语言</span>
            </span>
            <span class="icon-[heroicons--chevron-down] h-4 w-4"></span>
          </button>
          <div class="doc-version-dropdown">
            <a th:each="language : ${languages}" th:href="${language.link}" class="doc-version-item">
              <span th:text="${language.label}">语言名</span>
            </a>
          </div>
        </div>
      </th:block>

      <!-- 项目标题 -->
      <a th:href="${project.status.permalink}" class="doc-project-title">
        <span class="icon-[heroicons--book-open] text-primary h-5 w-5 shrink-0"></span>
        <span class="truncate" th:text="${project.spec.displayName}">文档项目</span>
      </a>

      <!-- 文档树导航 -->
      <ul class="doc-nav-tree">
        <th:block th:replace="~{modules/doc-content :: tree-item(docTrees=${docTrees})}" />
      </ul>
    </div>
  </aside>

  <!-- 主内容区 -->
  <main class="doc-main">
    <div class="doc-content-wrapper">
      <!-- 访问限制提示 - 非公开文档 -->
      <div th:if="${project?.spec != null and project.spec['public'] == false}" class="doc-restricted-banner">
        <span class="icon-[heroicons--lock-closed] h-5 w-5 shrink-0"></span>
        <span>此文档仅对登录用户可见</span>
      </div>

      <!-- 面包屑 -->
      <nav class="doc-breadcrumb" aria-label="面包屑导航">
        <a th:href="${project.status.permalink}" class="flex items-center gap-1">
          <span class="icon-[heroicons--home] h-4 w-4"></span>
          <span th:text="${project.spec.displayName}">首页</span>
        </a>
        <th:block th:each="crumb : ${crumbs}">
          <span class="icon-[heroicons--chevron-right] h-3 w-3 opacity-40"></span>
          <a th:href="${crumb.status.permalink}" th:text="${crumb.spec.title}">分类</a>
        </th:block>
      </nav>

      <!-- 文档标题 -->
      <h1 class="doc-title" th:text="${docTree.spec.title}">文档标题</h1>

      <!-- 文档正文内容 -->
      <article class="doc-article">
        <div id="article-content" class="prose prose-lg max-w-none" th:utext="${docInfo.content.content}">文档内容</div>
      </article>

      <!-- 互动卡片 - 作者/分享/翻页 -->
      <div class="card bg-base-100/80 border-base-content/5 mt-8 rounded-2xl border shadow-lg backdrop-blur-xl">
        <div class="card-body p-4 sm:p-6">
          <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
            <!-- 左侧：作者信息 + 分享 -->
            <div class="flex items-center gap-4">
              <!-- 作者头像+信息 -->
              <div
                th:if="${docInfo.doc.spec.owner}"
                th:with="contributor = ${contributorFinder.getContributor(docInfo.doc.spec.owner)}"
                class="flex items-center gap-3"
              >
                <!-- 头像 -->
                <div class="avatar">
                  <a
                    th:href="@{/authors/{name}(name=${contributor.name})}"
                    class="group/avatar ring-primary/20 ring-offset-base-100 block h-10 w-10 overflow-hidden rounded-full ring ring-offset-1"
                  >
                    <img
                      th:if="${contributor?.avatar}"
                      th:src="${contributor.avatar}"
                      th:alt="${contributor.displayName}"
                      class="h-full w-full object-cover transition-transform duration-300 group-hover/avatar:scale-110"
                    />
                    <div
                      th:unless="${contributor?.avatar}"
                      class="bg-primary/10 group-hover/avatar:bg-primary/20 flex h-full w-full items-center justify-center transition-colors"
                    >
                      <span class="icon-[heroicons--user] text-primary h-5 w-5"></span>
                    </div>
                  </a>
                </div>
                <!-- 作者名+时间 -->
                <div class="flex flex-col">
                  <a
                    th:href="@{/authors/{name}(name=${contributor.name})}"
                    class="text-base-content hover:text-primary text-sm font-medium transition-colors"
                    th:text="${contributor?.displayName ?: docInfo.doc.spec.owner}"
                    >作者名</a
                  >
                  <div class="text-base-content/50 flex items-center gap-2 text-xs">
                    <span
                      th:if="${docInfo.doc.spec.updatedAt}"
                      th:text="${'更新于 ' + #strings.substring(docInfo.doc.spec.updatedAt.toString(), 0, 10)}"
                    >
                      更新于 2025-01-01
                    </span>
                  </div>
                </div>
              </div>

              <!-- 分隔线 -->
              <div class="divider divider-horizontal mx-0 hidden h-8 sm:flex"></div>

              <!-- 分享按钮 - 使用文档独立配置 -->
              <button
                th:if="${theme.config.docsme.doc_settings?.enable_share != false}"
                x-data
                @click="$dispatch('open-share-modal')"
                class="btn btn-sm btn-ghost bg-base-200 hover:bg-primary/10 hover:text-primary gap-2 rounded-full border-0 transition-all duration-200"
              >
                <span class="icon-[heroicons--share] h-5 w-5"></span>
                <span class="hidden sm:inline">分享</span>
              </button>
            </div>

            <!-- 右侧：翻页导航 -->
            <div th:if="${linkNavigation}" class="flex w-full gap-2 sm:w-auto sm:max-w-[60%]">
              <!-- 上一篇 -->
              <a
                th:if="${linkNavigation.hasPrevious}"
                th:href="${linkNavigation.previous.link}"
                class="btn btn-ghost bg-base-200 hover:bg-primary/10 hover:text-primary group h-auto flex-1 flex-nowrap justify-start gap-2 overflow-hidden rounded-xl border-0 px-3 py-2"
              >
                <span
                  class="icon-[heroicons--arrow-left] h-4 w-4 shrink-0 opacity-60 transition-all group-hover:-translate-x-0.5 group-hover:opacity-100"
                ></span>
                <div class="flex min-w-0 flex-col items-start overflow-hidden">
                  <span class="text-[10px] opacity-50">上一篇</span>
                  <span class="w-full truncate text-xs font-medium" th:text="${linkNavigation.previous.title}"
                    >上一篇标题</span
                  >
                </div>
              </a>
              <div
                th:unless="${linkNavigation.hasPrevious}"
                class="btn btn-ghost bg-base-200/50 no-animation h-auto flex-1 cursor-not-allowed flex-nowrap justify-start gap-2 rounded-xl border-0 px-3 py-2 opacity-40"
              >
                <span class="icon-[heroicons--arrow-left] h-4 w-4 shrink-0 opacity-60"></span>
                <div class="flex flex-col items-start">
                  <span class="text-[10px] opacity-50">上一篇</span>
                  <span class="text-xs font-medium">没有了</span>
                </div>
              </div>

              <!-- 下一篇 -->
              <a
                th:if="${linkNavigation.hasNext}"
                th:href="${linkNavigation.next.link}"
                class="btn btn-ghost bg-base-200 hover:bg-primary/10 hover:text-primary group h-auto flex-1 flex-nowrap justify-end gap-2 overflow-hidden rounded-xl border-0 px-3 py-2"
              >
                <div class="flex min-w-0 flex-col items-end overflow-hidden">
                  <span class="text-[10px] opacity-50">下一篇</span>
                  <span class="w-full truncate text-right text-xs font-medium" th:text="${linkNavigation.next.title}"
                    >下一篇标题</span
                  >
                </div>
                <span
                  class="icon-[heroicons--arrow-right] h-4 w-4 shrink-0 opacity-60 transition-all group-hover:translate-x-0.5 group-hover:opacity-100"
                ></span>
              </a>
              <div
                th:unless="${linkNavigation.hasNext}"
                class="btn btn-ghost bg-base-200/50 no-animation h-auto flex-1 cursor-not-allowed flex-nowrap justify-end gap-2 rounded-xl border-0 px-3 py-2 opacity-40"
              >
                <div class="flex flex-col items-end">
                  <span class="text-[10px] opacity-50">下一篇</span>
                  <span class="text-xs font-medium">没有了</span>
                </div>
                <span class="icon-[heroicons--arrow-right] h-4 w-4 shrink-0 opacity-60"></span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 评论卡片 - 使用 project.spec.enableComment 判断是否启用评论 -->
      <div
        th:if="${project?.spec?.enableComment == true}"
        class="card bg-base-100/80 border-base-content/5 mt-4 overflow-hidden rounded-2xl border shadow-lg backdrop-blur-xl"
      >
        <!-- 评论区标题 -->
        <div class="border-base-content/5 bg-base-200/30 flex items-center justify-between border-b px-4 py-3 sm:px-6">
          <div class="text-base-content flex items-center gap-2 text-sm font-semibold">
            <span class="icon-[heroicons--chat-bubble-left-right] text-primary h-4 w-4"></span>
            <span>评论交流</span>
          </div>
        </div>
        <!-- Halo 评论组件 - 使用 docInfo.doc.metadata.name 作为评论关联名称 -->
        <div class="card-body p-4 sm:p-6">
          <halo:comment
            group="run.halo.docsme"
            kind="Doc"
            th:attr="name=${docInfo.doc.metadata.name}"
            colorScheme="system"
          />
        </div>
      </div>
    </div>
  </main>

  <!-- 右侧目录 - 固定定位，与文章页目录样式一致 -->
  <aside class="doc-toc hidden xl:block">
    <div id="toc-card" class="doc-toc-card">
      <h3 class="text-base-content/40 mb-4 flex items-center gap-2 text-xs font-bold tracking-wider uppercase">
        <span class="icon-[heroicons--list-bullet] h-4 w-4"></span>
        <span>本页目录</span>
      </h3>
      <div class="toc-container scrollbar-thin overflow-y-auto pr-2">
        <nav id="toc-nav" class="space-y-1" role="navigation" aria-label="文档目录">
          <!-- 目录将由 JavaScript 自动生成 -->
        </nav>
      </div>
    </div>
  </aside>
</div>

<!-- 分享弹窗 - 使用文档独立配置 -->
<th:block
  th:if="${theme.config.docsme.doc_settings?.enable_share != false}"
  th:replace="~{modules/share-modal :: shareModal(
    title='分享文档',
    shareUrl=${docTree.status.permalink},
    shareTitle=${docTree.spec.title},
    shareItemIds=${theme.config.docsme.doc_settings.share_settings.share_item_ids}
  )}"
/>

<!-- 递归渲染文档树 - 参考 Docsme 官方模板 -->
<th:block th:fragment="tree-item(docTrees)">
  <li th:each="currentDocTree : ${docTrees}">
    <!-- 文档链接 -->
    <a
      th:if="${currentDocTree.spec.type == 'DOC'}"
      th:href="${currentDocTree.status.permalink}"
      th:title="${currentDocTree.spec.title}"
      th:classappend="${currentDocTree.metadata.name == docTree.metadata.name} ? 'active' : ''"
    >
      <span th:text="${currentDocTree.spec.title}" class="truncate">标题</span>
    </a>
    <!-- 目录（可展开 + 可点击导航至目录页） -->
    <details
      th:if="${currentDocTree.spec.type == 'TREE'}"
      th:id="${currentDocTree.metadata.name}"
      th:open="${#arrays.contains(crumbs, currentDocTree) || currentDocTree.metadata.name == docTree.metadata.name}"
    >
      <summary th:title="${currentDocTree.spec.title}">
        <a
          th:href="${currentDocTree.status.permalink}"
          th:text="${currentDocTree.spec.title}"
          th:classappend="${currentDocTree.metadata.name == docTree.metadata.name} ? 'active' : ''"
          class="doc-nav-folder-link truncate"
          >分类标题</a
        >
      </summary>
      <ul th:if="${currentDocTree.children != null && !currentDocTree.children.isEmpty()}">
        <th:block th:replace="~{modules/doc-content :: tree-item(docTrees=${currentDocTree.children})}" />
      </ul>
    </details>
  </li>
</th:block>
