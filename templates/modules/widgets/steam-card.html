<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org">

<!-- ========================================== -->
<!--   Steam Mini Profile 卡片组件              -->
<!--   风格: DaisyUI 主题融合 + 游戏中特效       -->
<!-- ========================================== -->

<th:block th:fragment="card">
    <!-- 获取 Steam 数据 -->
    <th:block th:if="${steamFinder != null}" th:with="profile=${steamFinder.getProfile()},
                       stats=${steamFinder.getStats()},
                       badges=${steamFinder.getBadges()}">

        <!-- 仅当获取到 Profile 时显示 -->
        <a th:if="${profile != null}" href="/steam"
            class="card block bg-base-100/80 backdrop-blur-xl shadow-lg border border-base-content/5 rounded-[1.5rem] overflow-hidden group hover:shadow-xl transition-all duration-300 relative"
            th:classappend="${profile.playing ? 'ring-2 ring-accent/50 hover:ring-accent/70' : 'hover:border-primary/20'}">

            <!-- ========================= -->
            <!-- 背景层                    -->
            <!-- ========================= -->

            <!-- A. 游戏中: 游戏封面背景 -->
            <div th:if="${profile.playing && profile.summary.gameId != null}" class="absolute inset-0 z-0">
                <img th:src="@{'https://cdn.akamai.steamstatic.com/steam/apps/' + ${profile.summary.gameId} + '/header.jpg'}"
                    class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                    onerror="this.parentElement.classList.add('hidden');" />
                <!-- 深色渐变遮罩 - 确保白色文字始终可读 -->
                <div class="absolute inset-0 bg-gradient-to-r from-black/80 via-black/50 to-black/20"></div>
            </div>

            <!-- B. 非游戏中: Steam Logo 水印装饰 -->
            <div th:unless="${profile.playing}"
                class="absolute -right-6 -bottom-6 text-base-content/5 rotate-[-15deg] pointer-events-none z-0 transition-all duration-500 group-hover:rotate-[-10deg] group-hover:scale-110 group-hover:text-base-content/8">
                <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24"
                    fill="currentColor">
                    <path
                        d="M12 0C5.373 0 0 5.373 0 12c0 3.167 1.223 5.922 3.167 8.08L6.8 15.6c-.347-.723-.593-1.468-.593-2.31c0-2.872 2.328-5.2 5.2-5.2c2.872 0 5.2 2.328 5.2 5.2s-2.328 5.2-5.2 5.2c-.407 0-.796-.106-1.168-.2l-2.73 3.937A11.96 11.96 0 0 0 12 24c6.627 0 12-5.373 12-12S18.627 0 12 0m.593 14.4c-.722 0-1.2-.478-1.2-1.2c0-.722.478-1.2 1.2-1.2s1.2.478 1.2 1.2s-.478 1.2-1.2 1.2m0-3.6c-2.003 0-3.6 1.6-3.6 3.6c0 1.215.545 2.155 1.348 2.805l-2.09 3.016a2.4 2.4 0 0 1-.362-.023a2.4 2.4 0 1 1 1.706-3.924l2.257-3.256c.236.052.48.082.74.082c1.997 0 3.6-1.603 3.6-3.6s-1.603-3.6-3.6-3.6" />
                </svg>
            </div>

            <!-- ========================= -->
            <!-- 内容层                    -->
            <!-- ========================= -->
            <div class="relative z-10 p-5 flex items-center gap-4">

                <!-- 头像 -->
                <div class="relative shrink-0">
                    <div class="w-14 h-14 rounded-xl overflow-hidden ring-2 shadow-md transition-all"
                        th:classappend="${profile.playing ? 'ring-accent' : (profile.summary.personaState == 1 ? 'ring-success' : 'ring-base-content/10')}">
                        <img th:src="${profile.summary.avatar}" th:alt="${profile.summary.personaName}"
                            class="w-full h-full object-cover" />
                    </div>
                    <!-- 状态指示点 -->
                    <div class="absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 rounded-full ring-2 ring-base-100"
                        th:classappend="${profile.playing ? 'bg-accent animate-pulse' : (profile.summary.personaState == 1 ? 'bg-success' : 'bg-base-content/30')}">
                    </div>
                </div>

                <!-- 用户信息 -->
                <div class="flex-1 min-w-0">
                    <!-- 用户名 -->
                    <h3 class="text-sm font-bold truncate"
                        th:classappend="${profile.playing ? 'text-white' : 'text-base-content'}"
                        th:text="${profile.summary.personaName}">
                        Steam User</h3>

                    <!-- 状态文字 -->
                    <div class="mt-0.5 text-xs truncate">
                        <!-- 游戏中 -->
                        <span th:if="${profile.playing}" class="inline-flex items-center gap-1 text-accent font-medium">
                            <span class="w-1.5 h-1.5 rounded-full bg-accent animate-pulse shrink-0"></span>
                            <span class="truncate" th:text="${profile.statusText}">正在游玩</span>
                        </span>
                        <!-- 在线 -->
                        <span th:if="${!profile.playing && profile.summary.personaState == 1}"
                            class="text-success">在线</span>
                        <!-- 离线 -->
                        <span th:if="${!profile.playing && profile.summary.personaState != 1}"
                            class="text-base-content/50" th:text="${profile.statusText}">离线</span>
                    </div>
                </div>
            </div>

            <!-- ========================= -->
            <!-- 底部统计栏                -->
            <!-- ========================= -->
            <div class="relative z-10 px-4 pb-3">
                <div class="flex items-center pt-2 border-t"
                    th:classappend="${profile.playing ? 'border-white/20' : 'border-base-content/5'}">
                    <!-- 等级 -->
                    <div class="flex-1 text-center">
                        <div class="text-[10px] font-medium"
                            th:classappend="${profile.playing ? 'text-white/60' : 'text-base-content/40'}">Lv</div>
                        <div class="text-xs font-bold"
                            th:classappend="${profile.playing ? 'text-white' : 'text-base-content'}"
                            th:text="${badges?.playerLevel ?: '-'}">-</div>
                    </div>
                    <div class="w-px h-4" th:classappend="${profile.playing ? 'bg-white/20' : 'bg-base-content/10'}">
                    </div>
                    <!-- 游戏数 -->
                    <div class="flex-1 text-center">
                        <div class="text-[10px] font-medium"
                            th:classappend="${profile.playing ? 'text-white/60' : 'text-base-content/40'}">游戏</div>
                        <div class="text-xs font-bold"
                            th:classappend="${profile.playing ? 'text-white' : 'text-base-content'}"
                            th:text="${stats?.totalGames ?: '-'}">-</div>
                    </div>
                    <div class="w-px h-4" th:classappend="${profile.playing ? 'bg-white/20' : 'bg-base-content/10'}">
                    </div>
                    <!-- 总时长 -->
                    <div class="flex-1 text-center">
                        <div class="text-[10px] font-medium"
                            th:classappend="${profile.playing ? 'text-white/60' : 'text-base-content/40'}">时长</div>
                        <div class="text-xs font-bold"
                            th:classappend="${profile.playing ? 'text-white' : 'text-base-content'}"
                            th:text="${stats != null ? (stats.totalPlaytimeMinutes / 60) + 'h' : '-'}">-</div>
                    </div>
                </div>
            </div>

        </a>
    </th:block>

</html>