<!doctype html>
<html xmlns:th="https://www.thymeleaf.org">
  <!-- ========================================== -->
  <!--           作者归档页主体内容               -->
  <!-- 路由：/authors/:name                       -->
  <!-- 变量：author (UserVo), posts (分页列表)    -->
  <!-- ========================================== -->

  <main
    class="relative"
    th:fragment="author-content"
    th:with="cfg = ${theme.config.author_settings},
               contentCfg = ${cfg?.content_settings},
               globalSidebarCfg = ${theme.config.general.sidebar_settings},
               useCustomSidebar = ${cfg?.enable_custom_sidebar == true},
               sidebarPosition = ${useCustomSidebar ? (cfg?.sidebar_position ?: 'right') : (globalSidebarCfg?.position ?: 'right')},
               pageSize = ${contentCfg?.page_size ?: 10}"
  >
    <!-- 主体内容区域 -->
    <div class="mx-auto max-w-7xl px-4 py-8">
      <div class="flex gap-8" th:classappend="${sidebarPosition == 'left'} ? 'flex-row-reverse' : ''">
        <!-- 左侧：作者信息 + 内容区 -->
        <section class="min-w-0 flex-1" th:classappend="${cfg.show_sidebar != true ? 'max-w-4xl mx-auto' : ''}">
          <!-- ========== 作者信息卡片 ========== -->
          <div
            class="author-hero card bg-base-100/80 border-base-content/5 group relative mb-8 overflow-hidden rounded-2xl border p-6 shadow-lg backdrop-blur-xl transition-all duration-300 hover:shadow-xl md:p-8"
          >
            <!-- 背景装饰 -->
            <div
              class="from-primary/10 to-secondary/10 absolute -top-20 -right-20 h-48 w-48 rounded-full bg-gradient-to-br blur-3xl transition-transform duration-500 group-hover:scale-110"
            ></div>
            <div
              class="from-accent/10 to-primary/10 absolute -bottom-16 -left-16 h-40 w-40 rounded-full bg-gradient-to-tr blur-3xl transition-transform duration-500 group-hover:scale-110"
            ></div>

            <div class="relative flex flex-col items-center gap-6 md:flex-row md:items-start">
              <!-- 头像 -->
              <div class="flex-shrink-0">
                <div
                  class="ring-base-content/10 group-hover:ring-primary/30 relative h-24 w-24 overflow-hidden rounded-2xl shadow-lg ring-2 transition-all md:h-28 md:w-28"
                >
                  <img
                    th:if="${author.spec.avatar != null and !#strings.isEmpty(author.spec.avatar)}"
                    th:src="${author.spec.avatar}"
                    th:alt="${author.spec.displayName}"
                    class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
                  />
                  <div
                    th:unless="${author.spec.avatar != null and !#strings.isEmpty(author.spec.avatar)}"
                    class="from-primary/20 to-secondary/20 flex h-full w-full items-center justify-center bg-gradient-to-br"
                  >
                    <span class="icon-[heroicons--user] text-primary/60 h-12 w-12 md:h-14 md:w-14"></span>
                  </div>
                </div>
              </div>

              <!-- 作者信息 -->
              <div class="min-w-0 flex-1 text-center md:text-left">
                <!-- 显示名称 -->
                <h1 class="text-base-content mb-1 text-2xl font-bold md:text-3xl" th:text="${author.spec.displayName}">
                  用户名
                </h1>

                <!-- @用户名 -->
                <p class="text-base-content/50 mb-3 flex items-center justify-center gap-1 text-sm md:justify-start">
                  <span class="icon-[heroicons--at-symbol] h-4 w-4"></span>
                  <span th:text="${author.metadata.name}">username</span>
                </p>

                <!-- 个人简介 -->
                <p
                  th:if="${author.spec.bio != null and !#strings.isEmpty(author.spec.bio)}"
                  class="text-base-content/70 mb-4 line-clamp-2 leading-relaxed"
                  th:text="${author.spec.bio}"
                >
                  这是个人简介...
                </p>

                <!-- 统计信息 -->
                <div class="flex flex-wrap items-center justify-center gap-3 text-sm md:justify-start">
                  <!-- 文章数 -->
                  <div
                    class="bg-primary/10 text-primary border-primary/20 flex items-center gap-1.5 rounded-full border px-3 py-1.5"
                  >
                    <span class="icon-[heroicons--document-text] h-4 w-4"></span>
                    <span class="font-medium" th:text="${posts.total}">0</span>
                    <span class="text-primary/70">篇文章</span>
                  </div>

                  <!-- 注册时间 -->
                  <div
                    th:if="${author.spec.registeredAt != null}"
                    class="bg-base-200/50 text-base-content/60 border-base-content/5 flex items-center gap-1.5 rounded-full border px-3 py-1.5"
                  >
                    <span class="icon-[heroicons--calendar] h-4 w-4"></span>
                    <span>加入于</span>
                    <span th:text="${#temporals.format(author.spec.registeredAt, 'yyyy-MM-dd')}">2024-01-01</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ========== 文章列表 ========== -->
          <div class="author-posts mb-6">
            <h2 class="text-base-content mb-4 flex items-center gap-2 text-lg font-bold">
              <span class="icon-[heroicons--document-text] text-primary h-5 w-5"></span>
              文章列表
              <span class="text-base-content/50 text-sm font-normal" th:text="'(' + ${posts.total} + ')'"></span>
            </h2>

            <!-- 卡片文章列表 -->
            <div th:if="${posts.total > 0}" class="author-posts-list space-y-4">
              <th:block th:each="post, stat : ${posts.items}">
                <article
                  class="group card bg-base-100/80 border-base-content/5 hover:border-primary/20 flex flex-col gap-4 rounded-2xl border p-4 shadow-sm backdrop-blur-xl transition-all duration-300 hover:shadow-md md:flex-row md:items-stretch md:gap-5 md:p-5"
                >
                  <!-- 左侧封面 -->
                  <figure
                    th:if="${post.spec.cover != null and !#strings.isEmpty(post.spec.cover)}"
                    class="relative w-full shrink-0 overflow-hidden rounded-xl md:h-28 md:w-40"
                  >
                    <a th:href="${post.status.permalink}" class="block aspect-video w-full md:aspect-auto md:h-full">
                      <img
                        th:src="${post.spec.cover}"
                        th:alt="${post.spec.title}"
                        loading="lazy"
                        class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
                      />
                    </a>
                  </figure>

                  <!-- 右侧内容 -->
                  <div class="flex min-w-0 flex-1 flex-col">
                    <!-- 标题 -->
                    <h3 class="text-base leading-snug font-bold md:text-lg">
                      <a
                        th:href="${post.status.permalink}"
                        class="hover:text-primary transition-colors"
                        th:text="${post.spec.title}"
                        >文章标题</a
                      >
                    </h3>

                    <!-- 摘要 -->
                    <p
                      th:if="${post.status.excerpt != null and !#strings.isEmpty(post.status.excerpt)}"
                      class="text-base-content/70 mt-2 line-clamp-2 text-sm leading-relaxed"
                    >
                      <a
                        th:href="${post.status.permalink}"
                        class="hover:text-base-content"
                        th:text="${post.status.excerpt}"
                        >文章摘要...</a
                      >
                    </p>

                    <!-- 底部元信息 -->
                    <div class="mt-auto flex flex-wrap items-center justify-between gap-y-2 pt-3">
                      <!-- 左侧：分类 + 标签 -->
                      <div class="flex items-center gap-2 overflow-hidden">
                        <!-- 分类 -->
                        <span
                          th:if="${post.categories != null and !post.categories.isEmpty()}"
                          class="bg-primary/5 text-primary inline-flex shrink-0 items-center rounded-md px-2 py-0.5 text-[10px] font-medium"
                        >
                          <a
                            th:href="${post.categories[0].status.permalink}"
                            class="max-w-[100px] truncate hover:underline"
                            th:text="${post.categories[0].spec.displayName}"
                            >分类</a
                          >
                        </span>
                        <!-- 标签 -->
                        <div
                          th:if="${post.tags != null and !post.tags.isEmpty()}"
                          class="text-base-content/50 flex items-center gap-2 truncate text-xs"
                        >
                          <th:block th:each="tag, tagStat : ${post.tags}" th:if="${tagStat.index < 3}">
                            <a
                              th:href="${tag.status.permalink}"
                              class="hover:text-primary transition-colors"
                              th:text="'#' + ${tag.spec.displayName}"
                              >#标签</a
                            >
                          </th:block>
                        </div>
                      </div>

                      <!-- 右侧：时间 + 统计 -->
                      <div class="flex items-center gap-2">
                        <span
                          class="text-base-content/40 text-xs"
                          th:text="${#temporals.format(post.spec.publishTime, 'yyyy-MM-dd')}"
                          >2024-01-01</span
                        >
                        <div
                          class="bg-base-200/50 text-base-content/60 flex items-center gap-1.5 rounded-full px-2 py-1 text-[10px]"
                        >
                          <span class="icon-[heroicons--eye] h-3 w-3"></span>
                          <span th:text="${post.stats?.visit ?: 0}">0</span>
                        </div>
                        <div
                          class="bg-base-200/50 text-base-content/60 flex items-center gap-1.5 rounded-full px-2 py-1 text-[10px]"
                        >
                          <span class="icon-[heroicons--chat-bubble-left] h-3 w-3"></span>
                          <span th:text="${post.stats?.comment ?: 0}">0</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </article>
              </th:block>
            </div>

            <!-- 空状态 -->
            <div
              th:if="${posts.total == 0}"
              class="card bg-base-100/80 border-base-content/5 rounded-xl border p-12 text-center backdrop-blur-sm"
            >
              <span
                class="icon-[heroicons--document-magnifying-glass] text-base-content/20 mx-auto mb-4 h-16 w-16"
              ></span>
              <p class="text-base-content/60">该作者暂未发布任何文章</p>
            </div>

            <!-- 分页 -->
            <div th:if="${posts.totalPages > 1}" class="mt-8 flex items-center justify-center">
              <div class="bg-base-200/60 inline-flex items-center rounded-full p-1 backdrop-blur-md">
                <!-- 上一页 -->
                <a
                  th:href="${posts.prevUrl}"
                  class="text-base-content/60 hover:text-base-content hover:bg-base-100 flex h-9 w-9 items-center justify-center rounded-full transition-all duration-200"
                  th:classappend="${!posts.hasPrevious} ? 'opacity-30 pointer-events-none' : ''"
                >
                  <span class="icon-[heroicons--chevron-left] h-5 w-5"></span>
                </a>
                <!-- 页码 -->
                <span
                  class="text-base-content/50 px-4 text-xs font-semibold tracking-wide tabular-nums"
                  th:text="${posts.page} + ' / ' + ${posts.totalPages}"
                  >1 / 1</span
                >
                <!-- 下一页 -->
                <a
                  th:href="${posts.nextUrl}"
                  class="text-base-content/60 hover:text-base-content hover:bg-base-100 flex h-9 w-9 items-center justify-center rounded-full transition-all duration-200"
                  th:classappend="${!posts.hasNext} ? 'opacity-30 pointer-events-none' : ''"
                >
                  <span class="icon-[heroicons--chevron-right] h-5 w-5"></span>
                </a>
              </div>
            </div>
          </div>
        </section>

        <!-- 右侧：侧边栏 -->
        <aside
          th:if="${cfg.show_sidebar == true}"
          class="right-sidebar sticky top-20 hidden w-80 space-y-6 self-start lg:block"
        >
          <th:block th:replace="~{modules/widgets/sidebar :: dynamic(${cfg})}" />
        </aside>
      </div>
    </div>
  </main>
</html>
