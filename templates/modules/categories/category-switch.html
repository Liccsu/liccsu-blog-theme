<!doctype html>
<html xmlns:th="https://www.thymeleaf.org">
  <!-- ========================================== -->
  <!--        分类切换块组件 - 现代化简约风格      -->
  <!-- ========================================== -->

  <!-- 
  风格说明 (所有风格都支持折叠):
  1. pills - 药丸风格：简约标签，无外层容器
  2. chips - 芯片风格：圆角边框，带计数
  3. underline - 下划线风格：极简，文字+下划线
  4. glass - 玻璃拟态：轻量毛玻璃
-->

  <!-- ===================== -->
  <!-- 药丸风格 - 胶囊徽章 -->
  <!-- ===================== -->
  <div
    th:fragment="pills(categories, currentCategory)"
    class="categories-switch-pills mb-8"
    th:with="maxVisible = 6, totalCategories = ${#lists.size(categories)}, needsCollapse = ${totalCategories > maxVisible}"
    x-data="{ expanded: false }"
  >
    <div class="flex flex-wrap items-center gap-2">
      <!-- 全部按钮 -->
      <a
        th:href="@{/categories}"
        class="inline-flex items-center gap-1.5 rounded-full border px-3.5 py-1.5 text-sm font-medium transition-all duration-200"
        th:classappend="${currentCategory == null} ? 'bg-base-100 text-base-content shadow-sm border-base-content/10' : 'bg-base-100/60 text-base-content/60 border-base-content/5 hover:bg-base-100 hover:text-base-content hover:shadow-sm hover:border-base-content/10'"
      >
        <span class="icon-[heroicons--squares-2x2] h-3.5 w-3.5"></span>
        <span>全部</span>
      </a>

      <!-- 分类 -->
      <th:block th:each="c, iterStat : ${categories}">
        <a
          th:href="@{${c.status.permalink}}"
          th:with="postCount=${c.status.postCount ?: 0}"
          class="inline-flex items-center gap-1.5 rounded-full border px-3.5 py-1.5 text-sm font-medium transition-all duration-200"
          th:classappend="${currentCategory != null and currentCategory.metadata.name == c.metadata.name} ? 'bg-base-100 text-base-content shadow-sm border-base-content/10' : 'bg-base-100/60 text-base-content/60 border-base-content/5 hover:bg-base-100 hover:text-base-content hover:shadow-sm hover:border-base-content/10'"
          th:data-collapsible="${needsCollapse and iterStat.index >= maxVisible}"
          th:style="${needsCollapse and iterStat.index >= maxVisible ? 'display: none' : ''}"
          th:attr="x-init=${needsCollapse and iterStat.index >= maxVisible and currentCategory != null and currentCategory.metadata.name == c.metadata.name} ? 'expanded = true' : null"
          x-effect="if ($el.dataset.collapsible === 'true') { $el.style.display = expanded ? '' : 'none' }"
        >
          <span class="icon-[heroicons--folder] text-base-content/40 h-3.5 w-3.5"></span>
          <span th:text="${c.spec.displayName}"></span>
          <span th:if="${postCount > 0}" class="text-base-content/50 text-xs" th:text="${postCount}"></span>
        </a>
      </th:block>

      <!-- 展开/收起 -->
      <button
        th:if="${needsCollapse}"
        @click="expanded = !expanded"
        class="border-base-content/20 text-base-content/50 hover:text-base-content hover:border-base-content/30 hover:bg-base-100/50 inline-flex cursor-pointer items-center gap-1 rounded-full border border-dashed px-3 py-1.5 text-sm font-medium transition-all duration-200"
      >
        <span x-show="!expanded" class="icon-[heroicons--chevron-down] h-3.5 w-3.5"></span>
        <span x-show="expanded" class="icon-[heroicons--chevron-up] h-3.5 w-3.5"></span>
        <span x-show="!expanded" th:text="'+' + ${totalCategories - maxVisible}"></span>
        <span x-show="expanded">收起</span>
      </button>
    </div>
  </div>

  <!-- ===================== -->
  <!-- 芯片风格 - 边框卡片   -->
  <!-- ===================== -->
  <div
    th:fragment="chips(categories, currentCategory)"
    class="categories-switch-chips mb-8"
    th:with="maxVisible = 10, totalCategories = ${#lists.size(categories)}, needsCollapse = ${totalCategories > maxVisible}"
    x-data="{ expanded: false }"
  >
    <div class="flex flex-wrap justify-center gap-2">
      <!-- 全部芯片 -->
      <a
        th:href="@{/categories}"
        class="inline-flex h-9 items-center gap-2 rounded-lg border px-4 text-sm font-medium transition-all duration-200"
        th:classappend="${currentCategory == null} ? 'bg-primary/10 text-primary border-primary/30' : 'bg-base-100 text-base-content/60 border-base-content/10 hover:border-primary/30 hover:text-primary'"
      >
        <span class="icon-[heroicons--squares-2x2] h-4 w-4"></span>
        <span>全部</span>
      </a>

      <!-- 分类芯片 -->
      <th:block th:each="c, iterStat : ${categories}">
        <a
          th:href="@{${c.status.permalink}}"
          th:with="postCount=${c.status.postCount ?: 0}"
          class="inline-flex h-9 items-center gap-1.5 rounded-lg border px-4 text-sm font-medium transition-all duration-200"
          th:classappend="${currentCategory != null and currentCategory.metadata.name == c.metadata.name} ? 'bg-primary/10 text-primary border-primary/30' : 'bg-base-100 text-base-content/60 border-base-content/10 hover:border-primary/30 hover:text-primary'"
          th:data-collapsible="${needsCollapse and iterStat.index >= maxVisible}"
          th:style="${needsCollapse and iterStat.index >= maxVisible ? 'display: none' : ''}"
          th:attr="x-init=${needsCollapse and iterStat.index >= maxVisible and currentCategory != null and currentCategory.metadata.name == c.metadata.name} ? 'expanded = true' : null"
          x-effect="if ($el.dataset.collapsible === 'true') { $el.style.display = expanded ? '' : 'none' }"
        >
          <span class="icon-[heroicons--folder] h-4 w-4 opacity-50"></span>
          <span th:text="${c.spec.displayName}"></span>
          <span th:if="${postCount > 0}" class="text-xs opacity-50" th:text="'(' + ${postCount} + ')'"></span>
        </a>
      </th:block>

      <!-- 展开/收起 -->
      <button
        th:if="${needsCollapse}"
        @click="expanded = !expanded"
        class="border-primary/30 text-primary/70 hover:text-primary hover:bg-primary/5 inline-flex h-9 cursor-pointer items-center gap-1 rounded-lg border border-dashed px-3 text-sm font-medium transition-all duration-200"
      >
        <span x-show="!expanded" class="icon-[heroicons--plus] h-4 w-4"></span>
        <span x-show="expanded" class="icon-[heroicons--minus] h-4 w-4"></span>
        <span x-show="!expanded" th:text="${totalCategories - maxVisible}"></span>
        <span x-show="expanded">收起</span>
      </button>
    </div>
  </div>

  <!-- ===================== -->
  <!-- 下划线风格 - 极简     -->
  <!-- ===================== -->
  <div
    th:fragment="underline(categories, currentCategory)"
    class="categories-switch-underline mb-8"
    th:with="maxVisible = 12, totalCategories = ${#lists.size(categories)}, needsCollapse = ${totalCategories > maxVisible}"
    x-data="{ expanded: false }"
  >
    <div class="border-base-content/10 flex flex-wrap items-center justify-center gap-x-1 gap-y-0 border-b pb-px">
      <!-- 全部 -->
      <a
        th:href="@{/categories}"
        class="relative px-3 py-2.5 text-sm font-medium transition-colors duration-200"
        th:classappend="${currentCategory == null} ? 'text-primary' : 'text-base-content/50 hover:text-base-content'"
      >
        <span>全部</span>
        <span
          th:if="${currentCategory == null}"
          class="bg-primary absolute right-1 bottom-0 left-1 h-0.5 rounded-full"
        ></span>
      </a>

      <!-- 分类 -->
      <th:block th:each="c, iterStat : ${categories}">
        <a
          th:href="@{${c.status.permalink}}"
          th:with="postCount=${c.status.postCount ?: 0}"
          class="relative px-3 py-2.5 text-sm font-medium transition-colors duration-200"
          th:classappend="${currentCategory != null and currentCategory.metadata.name == c.metadata.name} ? 'text-primary' : 'text-base-content/50 hover:text-base-content'"
          th:data-collapsible="${needsCollapse and iterStat.index >= maxVisible}"
          th:style="${needsCollapse and iterStat.index >= maxVisible ? 'display: none' : ''}"
          th:attr="x-init=${needsCollapse and iterStat.index >= maxVisible and currentCategory != null and currentCategory.metadata.name == c.metadata.name} ? 'expanded = true' : null"
          x-effect="if ($el.dataset.collapsible === 'true') { $el.style.display = expanded ? '' : 'none' }"
        >
          <span th:text="${c.spec.displayName}"></span>
          <sup th:if="${postCount > 0}" class="ml-0.5 text-xs opacity-40" th:text="${postCount}"></sup>
          <span
            th:if="${currentCategory != null and currentCategory.metadata.name == c.metadata.name}"
            class="bg-primary absolute right-1 bottom-0 left-1 h-0.5 rounded-full"
          ></span>
        </a>
      </th:block>

      <!-- 展开/收起 -->
      <button
        th:if="${needsCollapse}"
        @click="expanded = !expanded"
        class="text-primary/60 hover:text-primary cursor-pointer px-3 py-2.5 text-sm font-medium transition-colors duration-200"
      >
        <span x-show="!expanded" th:text="'+' + ${totalCategories - maxVisible} + ' 更多'"></span>
        <span x-show="expanded">收起</span>
      </button>
    </div>
  </div>

  <!-- ===================== -->
  <!-- 玻璃拟态风格 - 轻量   -->
  <!-- ===================== -->
  <div
    th:fragment="glass(categories, currentCategory)"
    class="categories-switch-glass mb-8"
    th:with="maxVisible = 10, totalCategories = ${#lists.size(categories)}, needsCollapse = ${totalCategories > maxVisible}"
    x-data="{ expanded: false }"
  >
    <div
      class="bg-base-200/40 dark:bg-base-300/30 flex flex-wrap justify-center gap-2 rounded-2xl p-3 backdrop-blur-sm"
    >
      <!-- 全部 -->
      <a
        th:href="@{/categories}"
        class="rounded-xl px-4 py-2 text-sm font-medium transition-all duration-200"
        th:classappend="${currentCategory == null} ? 'bg-base-100 text-base-content shadow-sm dark:bg-base-100/90' : 'text-base-content/50 hover:text-base-content hover:bg-base-100/60'"
      >
        全部
      </a>

      <!-- 分类 -->
      <th:block th:each="c, iterStat : ${categories}">
        <a
          th:href="@{${c.status.permalink}}"
          th:with="postCount=${c.status.postCount ?: 0}"
          class="inline-flex items-center gap-1.5 rounded-xl px-4 py-2 text-sm font-medium transition-all duration-200"
          th:classappend="${currentCategory != null and currentCategory.metadata.name == c.metadata.name} ? 'bg-base-100 text-base-content shadow-sm dark:bg-base-100/90' : 'text-base-content/50 hover:text-base-content hover:bg-base-100/60'"
          th:data-collapsible="${needsCollapse and iterStat.index >= maxVisible}"
          th:style="${needsCollapse and iterStat.index >= maxVisible ? 'display: none' : ''}"
          th:attr="x-init=${needsCollapse and iterStat.index >= maxVisible and currentCategory != null and currentCategory.metadata.name == c.metadata.name} ? 'expanded = true' : null"
          x-effect="if ($el.dataset.collapsible === 'true') { $el.style.display = expanded ? '' : 'none' }"
        >
          <span th:text="${c.spec.displayName}"></span>
          <span
            th:if="${postCount > 0}"
            class="bg-base-content/10 rounded-md px-1.5 py-0.5 text-xs"
            th:text="${postCount}"
          ></span>
        </a>
      </th:block>

      <!-- 展开/收起 -->
      <button
        th:if="${needsCollapse}"
        @click="expanded = !expanded"
        class="text-primary/70 hover:text-primary hover:bg-base-100/60 cursor-pointer rounded-xl px-4 py-2 text-sm font-medium transition-all duration-200"
      >
        <span x-show="!expanded" class="inline-flex items-center gap-1">
          <span th:text="'+' + ${totalCategories - maxVisible}"></span>
        </span>
        <span x-show="expanded">收起</span>
      </button>
    </div>
  </div>
</html>
