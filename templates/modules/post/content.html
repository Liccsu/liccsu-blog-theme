<!-- 主要内容区域 -->
<main
  class="relative"
  th:fragment="post-content"
  th:with="cfg = ${theme.config.article.sidebar_settings},
               contentCfg = ${theme.config.article.content_settings},
               showExcerpt = ${contentCfg?.show_excerpt != false},
               globalSidebarCfg = ${theme.config.general.sidebar_settings},
               useCustomSidebar = ${cfg?.enable_custom_sidebar == true},
               sidebarPosition = ${useCustomSidebar ? (cfg?.sidebar_position ?: 'right') : (globalSidebarCfg?.position ?: 'right')}"
>
  <!-- 顶部 Banner -->
  <th:block th:replace="~{modules/post/header :: banner}" />

  <!-- 主体内容区域 -->
  <div class="mx-auto max-w-7xl px-4 py-8">
    <div class="lazy-anim flex gap-8" th:classappend="${sidebarPosition == 'left'} ? 'flex-row-reverse' : ''">
      <!-- 左侧文章内容区 -->
      <article
        class="article-container min-w-0 flex-1"
        th:classappend="${cfg.show_sidebar == false ? 'max-w-4xl mx-auto' : 'lg:w-3/4'}"
      >
        <div class="prose prose-lg max-w-none">
          <!-- 文章摘要 - 打字机效果 -->
          <th:block th:if="${showExcerpt}" th:with="excerptText = ${post.status.excerpt ?: ''}">
            <div
              th:if="${!#strings.isEmpty(excerptText)}"
              class="article-excerpt"
              x-data="articleExcerpt"
              x-init="init()"
            >
              <span class="excerpt-text" x-ref="excerptText" th:attr="data-text=${excerptText}"></span
              ><span class="excerpt-cursor" x-show="typing">|</span>
            </div>
          </th:block>

          <!-- 文章正文内容 -->
          <div id="article-content" th:utext="${post.content.content}" class="prose prose-lg max-w-none"></div>
        </div>

        <!-- 文章底部交互栏 (点赞/分享/评论) -->
        <th:block th:replace="~{modules/post/article-footer :: footer}" />
      </article>

      <!-- 右侧功能区块 - 整体跟随滚动 -->
      <aside
        th:if="${cfg.show_sidebar != false}"
        class="right-sidebar sticky top-20 hidden w-80 space-y-6 self-start lg:block"
      >
        <!-- 动态小工具 (包括文章目录 toc) -->
        <th:block th:replace="~{modules/widgets/sidebar :: dynamic(${cfg})}" />
      </aside>
    </div>
  </div>
</main>
