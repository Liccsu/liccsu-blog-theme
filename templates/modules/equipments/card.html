<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org">

<!-- ========================================== -->
<!--   装备卡片组件 - 3D 战术终端版              -->
<!-- ========================================== -->

<th:block th:fragment="equipment-card(equipment, group, stat)">
    <a th:href="${equipment.spec.url}" target="_blank" class="card-scene block">
        <div class="card-wrap group" th:attr="data-style=${#annotations.getOrDefault(equipment, 'cardStyle', 'gold')}"
            th:styleappend="${#annotations.get(equipment, 'cardStyle') == 'custom' ? '--custom-color:' + #annotations.getOrDefault(equipment, 'customColor', '#8b5cf6') : ''}">

            <!-- 物理层 (Chassis) -->
            <div class="card-chassis">
                <div class="deco-plate plate-top"></div>
                <div class="deco-plate plate-bottom"></div>
                <div class="card-foil"></div>
                <div class="card-sheen"></div>
                <div class="side-track st-left">
                    <div class="track-bit"></div>
                    <div class="track-bit"></div>
                </div>
                <div class="side-track st-right">
                    <div class="track-bit"></div>
                    <div class="track-bit"></div>
                </div>
            </div>

            <!-- 全息边框 -->
            <div class="card-border-glow"></div>

            <!-- 装饰性角标 -->
            <div class="corner-marker cm-tl"></div>
            <div class="corner-marker cm-tr"></div>
            <div class="corner-marker cm-bl"></div>
            <div class="corner-marker cm-br"></div>

            <!-- 内容层 -->
            <div class="content-layer font-tech">
                <!-- 头部 -->
                <div class="card-header">
                    <div>
                        <span class="card-badge font-mono">PRODUCT_OVERVIEW</span>
                        <h3 class="card-name" th:text="${equipment.spec.displayName}">装备名称</h3>
                    </div>
                    <div class="card-header-right">
                        <div class="card-accent-bar"></div>
                        <span class="card-address font-mono" th:with="foundGroup=${groups != null and equipment.spec.groupName != null ? groups.^[metadata.name == '__${equipment.spec.groupName}__'] : null},
                                     finalGroup=${group ?: foundGroup}"
                            th:text="${finalGroup?.spec?.displayName ?: 'SPEC'}">分组</span>
                    </div>
                </div>

                <!-- 图片视窗 -->
                <div class="img-viewport">
                    <img th:if="${equipment.spec.cover}" th:src="${equipment.spec.cover}"
                        th:alt="${equipment.spec.displayName}" loading="lazy">
                    <div th:unless="${equipment.spec.cover}" class="img-viewport-placeholder">
                        <span class="icon-[heroicons--photo] w-12 h-12"></span>
                    </div>
                    <div class="img-corner img-corner-tl"></div>
                    <div class="img-corner img-corner-br"></div>
                </div>

                <!-- 描述 -->
                <p class="card-desc" th:text="${equipment.spec.description ?: 'No description available.'}">描述文字...</p>

                <!-- 规格参数 -->
                <div class="data-grid font-mono" th:if="${#annotations.get(equipment, 'specs') != null}"
                    th:with="specsText=${#annotations.get(equipment, 'specs')}">
                    <th:block th:each="line : ${#strings.arraySplit(specsText, '
')}">
                        <th:block th:if="${#strings.contains(line, ':') or #strings.contains(line, '：')}"
                            th:with="parts=${#strings.contains(line, '：') ? #strings.arraySplit(line, '：') : #strings.arraySplit(line, ':')}">
                            <!-- 过滤掉进度条参数 |xxx，只显示值部分 -->
                            <th:block
                                th:with="rawValue=${#strings.trim(parts[1])},
                                               cleanValue=${#strings.contains(rawValue, '|') ? #strings.trim(#strings.substringBefore(rawValue, '|')) : rawValue}">
                                <div class="data-item">
                                    <span class="data-label" th:text="${#strings.trim(parts[0])}">KEY</span>
                                    <span class="data-value" th:text="${cleanValue}">VALUE</span>
                                </div>
                            </th:block>
                        </th:block>
                    </th:block>
                </div>

                <!-- 底部 -->
                <div class="card-footer">
                    <div class="card-footer-bar"></div>
                    <span class="card-footer-id font-mono uppercase"
                        th:with="id=${equipment.metadata.name}, len=${#strings.length(id)}"
                        th:text="'ID. ' + ${#strings.substring(id, len > 6 ? len - 6 : 0)}">ID. 8X92A1</span>
                </div>
            </div>
        </div>
    </a>
</th:block>

</html>