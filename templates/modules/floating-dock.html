<!doctype html>
<html xmlns:th="https://www.thymeleaf.org">
  <!-- ========================================== -->
  <!--             悬浮控制栏组件                  -->
  <!-- ========================================== -->

  <!-- 
  参数说明：
  - pageCfg: 页面配置（可选），包含 floating_dock 子配置
  - pageType: 页面类型 - basic(基础) | comment(支持评论)
  - 如果 pageCfg.floating_dock.enable_custom_dock == true，使用页面自定义配置
  - 否则使用全局 general.floating_dock 配置
-->

  <!-- 通用悬浮 Dock 片段（保持向后兼容） -->
  <th:block th:fragment="dock">
    <th:block th:replace="~{:: dockWithConfig(null, 'basic')}" />
  </th:block>

  <!-- 支持传参的悬浮 Dock 片段 - 根据样式选择显示底部或右侧 -->
  <th:block
    th:fragment="dockWithConfig(pageCfg, pageType)"
    th:with="globalCfg = ${theme.config.general.floating_dock},
                   dockStyle = ${globalCfg?.dock_style ?: 'bottom'},
                   useCustom = ${pageCfg?.floating_dock?.enable_custom_dock == true},
                   cfg = ${useCustom ? pageCfg.floating_dock : globalCfg},
                   enableDock = ${cfg?.enable_dock != false},
                   dockMenuName = ${cfg?.dock_menu ?: 'primary'},
                   enableBackToTop = ${cfg?.enable_back_to_top != false}"
  >
    <!-- 底部居中样式 -->
    <th:block th:if="${enableDock and dockStyle != 'side'}" th:insert="~{:: bottomDockInner}" />
    <!-- 右侧可折叠样式 -->
    <th:block th:if="${enableDock and dockStyle == 'side'}" th:insert="~{:: sideDockInner}" />
  </th:block>

  <!-- 底部居中悬浮 Dock（内部片段，继承父级变量） -->
  <th:block th:fragment="bottomDockInner">
    <div
      x-data="floatingDock"
      x-show="isVisible"
      x-transition:enter="transition ease-in-out duration-400"
      x-transition:enter-start="opacity-0 translate-y-8"
      x-transition:enter-end="opacity-100 translate-y-0"
      x-transition:leave="transition ease-in-out duration-300"
      x-transition:leave-start="opacity-100 translate-y-0"
      x-transition:leave-end="opacity-0 translate-y-4"
      class="fixed bottom-6 left-1/2 z-40 -translate-x-1/2"
    >
      <!-- Dock 容器 -->
      <div
        class="dock-container bg-base-100/90 border-base-300/30 rounded-full border px-2 py-1.5 shadow-lg backdrop-blur-md"
      >
        <!-- Dock 按钮组 -->
        <div class="flex items-center gap-1">
          <!-- 自定义菜单图标 -->
          <th:block th:with="dockMenu = ${menuFinder.getByName(dockMenuName)}">
            <th:block th:if="${dockMenu != null}">
              <a
                th:each="menuItem : ${dockMenu.menuItems}"
                th:href="@{${menuItem.status.href}}"
                th:target="${menuItem.spec.target?.value}"
                class="dock-item dock-btn group relative"
                th:title="${menuItem.status.displayName}"
                th:aria-label="${menuItem.status.displayName}"
              >
                <!-- 使用菜单的自定义元数据 icon 字段（SVG 代码） -->
                <div
                  th:if="${menuItem.metadata?.annotations != null && menuItem.metadata.annotations['icon'] != null}"
                  class="flex h-4 w-4 items-center justify-center transition-transform duration-200 group-hover:scale-110"
                >
                  <div th:utext="${menuItem.metadata.annotations['icon']}" class="dock-icon-svg"></div>
                </div>
                <!-- 备用图标（如果没有自定义 icon） -->
                <span
                  th:unless="${menuItem.metadata?.annotations != null && menuItem.metadata.annotations['icon'] != null}"
                  class="icon-[heroicons--home] h-4 w-4 transition-transform duration-200 group-hover:scale-110"
                >
                </span>
                <span
                  class="dock-tooltip bg-base-content text-base-100 pointer-events-none absolute -top-10 left-1/2 -translate-x-1/2 rounded px-2 py-1 text-xs whitespace-nowrap opacity-0 transition-opacity duration-200 group-hover:opacity-100"
                  th:text="${menuItem.status.displayName}"
                >
                </span>
              </a>
            </th:block>
          </th:block>

          <!-- 分隔线（当有后续功能时显示） -->
          <div class="h-6 w-px" th:if="${enableBackToTop}"></div>

          <!-- 返回顶部按钮 -->
          <button
            th:if="${enableBackToTop}"
            @click="scrollToTop()"
            class="dock-item dock-btn"
            title="返回顶部"
            aria-label="返回顶部"
          >
            <span class="icon-[heroicons--arrow-up] h-4 w-4"></span>
          </button>
        </div>
      </div>
    </div>
  </th:block>

  <!-- ========================================== -->
  <!--   右侧可折叠悬浮 Dock（使用 DaisyUI FAB）    -->
  <!-- ========================================== -->

  <th:block th:fragment="sideDockInner">
    <div x-data="sideFloatingDock" x-show="isVisible" class="fixed right-4 bottom-6 z-40">
      <!-- DaisyUI FAB 组件 -->
      <div class="fab fab-top">
        <!-- 触发按钮 -->
        <div tabindex="0" role="button" class="btn btn-circle btn-primary shadow-lg">
          <span class="icon-[heroicons--squares-2x2] h-5 w-5"></span>
        </div>

        <!-- 关闭按钮（展开时显示） -->
        <div class="fab-close">
          <span class="text-base-content/70 hidden text-sm whitespace-nowrap sm:block">关闭</span>
          <span class="btn btn-circle btn-neutral shadow-lg">
            <span class="icon-[heroicons--x-mark] h-5 w-5"></span>
          </span>
        </div>

        <!-- 自定义菜单项 -->
        <th:block th:with="dockMenu = ${menuFinder.getByName(dockMenuName)}">
          <th:block th:if="${dockMenu != null}">
            <div th:each="menuItem : ${dockMenu.menuItems}">
              <span class="hidden text-sm whitespace-nowrap sm:block" th:text="${menuItem.status.displayName}"
                >菜单</span
              >
              <a
                th:href="@{${menuItem.status.href}}"
                th:target="${menuItem.spec.target?.value}"
                class="btn btn-circle"
                th:title="${menuItem.status.displayName}"
                th:aria-label="${menuItem.status.displayName}"
              >
                <div
                  th:if="${menuItem.metadata?.annotations != null && menuItem.metadata.annotations['icon'] != null}"
                  class="flex h-5 w-5 items-center justify-center"
                >
                  <div th:utext="${menuItem.metadata.annotations['icon']}" class="dock-icon-svg"></div>
                </div>
                <span
                  th:unless="${menuItem.metadata?.annotations != null && menuItem.metadata.annotations['icon'] != null}"
                  class="icon-[heroicons--home] h-5 w-5"
                ></span>
              </a>
            </div>
          </th:block>
        </th:block>

        <!-- 返回顶部按钮 -->
        <div th:if="${enableBackToTop}">
          <span class="hidden text-sm whitespace-nowrap sm:block">返回顶部</span>
          <button class="btn btn-circle" @click="scrollToTop()">
            <span class="icon-[heroicons--arrow-up] h-5 w-5"></span>
          </button>
        </div>
      </div>
    </div>
  </th:block>
</html>
