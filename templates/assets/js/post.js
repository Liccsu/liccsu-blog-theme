function e(){return{tocVisible:!1,activeHeading:"",readingProgress:0,codeBlocks:[],init(){this.initToc(),this.initReadingProgress(),this.initCodeBlocks(),this.initImageZoom(),console.log("文章页面控制器已初始化")},initToc(){const e=document.querySelectorAll(".post-content h1, .post-content h2, .post-content h3, .post-content h4, .post-content h5, .post-content h6");if(0===e.length)return;this.generateToc(e);const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(this.activeHeading=e.target.id,this.updateTocActive())})},{rootMargin:"-20% 0px -70% 0px"});e.forEach(e=>{e.id||(e.id=this.generateHeadingId(e.textContent)),t.observe(e)})},generateToc(e){const t=document.querySelector(".post-toc");if(!t)return;let o="<ul>",n=1;e.forEach(e=>{const t=parseInt(e.tagName.charAt(1)),i=e.id||this.generateHeadingId(e.textContent),c=e.textContent;t>n?o+="<ul>".repeat(t-n):t<n&&(o+="</ul>".repeat(n-t)),o+=`<li><a href="#${i}" @click="scrollToHeading('${i}')">${c}</a></li>`,n=t}),o+="</ul>",t.innerHTML=o},generateHeadingId:e=>e.toLowerCase().replace(/[^\w\u4e00-\u9fa5]+/g,"-").replace(/^-+|-+$/g,""),updateTocActive(){document.querySelectorAll(".post-toc a").forEach(e=>{e.classList.remove("active"),e.getAttribute("href")===`#${this.activeHeading}`&&e.classList.add("active")})},scrollToHeading(e){const t=document.getElementById(e);t&&window.SkyUtils.scrollToElement(t,80)},initReadingProgress(){const e=document.querySelector(".post-content");if(!e)return;const t=window.SkyUtils.throttle(()=>{const t=e.getBoundingClientRect(),o=e.offsetHeight,n=window.innerHeight,i=Math.max(0,-t.top),c=o-n;this.readingProgress=c>0?Math.min(100,i/c*100):0},100);window.addEventListener("scroll",t),t()},initCodeBlocks(){document.querySelectorAll("pre code").forEach((e,t)=>{const o=e.parentElement,n=document.createElement("button");n.className="btn btn-sm btn-ghost absolute top-2 right-2 opacity-70 hover:opacity-100",n.innerHTML="复制",n.onclick=()=>this.copyCode(e,n),o.style.position="relative",o.appendChild(n);const i=e.className.match(/language-(\w+)/);if(i){const e=document.createElement("span");e.className="absolute top-2 left-2 text-xs opacity-70 bg-base-300 px-2 py-1 rounded",e.textContent=i[1],o.appendChild(e)}})},async copyCode(e,t){const o=e.textContent;await window.SkyUtils.copyToClipboard(o)?(t.textContent="已复制",t.classList.add("btn-success"),setTimeout(()=>{t.textContent="复制",t.classList.remove("btn-success")},2e3)):(t.textContent="复制失败",t.classList.add("btn-error"),setTimeout(()=>{t.textContent="复制",t.classList.remove("btn-error")},2e3))},initImageZoom(){document.querySelectorAll(".post-content img").forEach(e=>{e.style.cursor="zoom-in",e.onclick=()=>this.zoomImage(e)})},zoomImage(e){const t=document.createElement("div");t.className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",t.onclick=()=>t.remove();const o=document.createElement("img");o.src=e.src,o.className="max-w-full max-h-full object-contain",o.onclick=e=>e.stopPropagation(),t.appendChild(o),document.body.appendChild(t);const n=document.createElement("button");n.className="absolute top-4 right-4 text-white text-2xl hover:text-gray-300",n.innerHTML="×",n.onclick=()=>t.remove(),t.appendChild(n)},toggleToc(){this.tocVisible=!this.tocVisible}}}window.PostShare={shareToWeibo(){const e=encodeURIComponent(window.location.href),t=encodeURIComponent(document.title);window.open(`https://service.weibo.com/share/share.php?url=${e}&title=${t}`)},shareToQzone(){const e=encodeURIComponent(window.location.href),t=encodeURIComponent(document.title);window.open(`https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=${e}&title=${t}`)},async copyLink(){await window.SkyUtils.copyToClipboard(window.location.href)&&console.log("链接已复制到剪贴板")}},document.addEventListener("alpine:init",()=>{Alpine.data("postController",e)}),console.log("Sky Theme - 文章页面脚本已加载");
