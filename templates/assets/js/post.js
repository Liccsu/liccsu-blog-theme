import"./chunks/article-content-CHvYTPdu.js";import{a as t,b as e,c as n,s as o}from"./chunks/toc-utils-mjK1J2vB.js";document.addEventListener("alpine:init",()=>{Alpine.data("articleExcerpt",()=>({typing:!0,text:"",fullText:"",charIndex:0,typingSpeed:50,init(){const t=this.$refs.excerptText;t&&(this.fullText=t.dataset.text||"",this.startTyping())},startTyping(){if(this.charIndex<this.fullText.length){this.text+=this.fullText.charAt(this.charIndex),this.$refs.excerptText.textContent=this.text,this.charIndex++;const t=this.fullText.charAt(this.charIndex-1);let e=this.typingSpeed;"，。！？、；：".includes(t)?e=200:",.!?;:".includes(t)&&(e=150),setTimeout(()=>this.startTyping(),e)}else setTimeout(()=>{this.typing=!1},500)}})),Alpine.data("postLike",()=>({isLiked:!1,likeCount:0,postName:"",init(){const t=this.$el.closest("[data-post-name]");t&&(this.postName=t.dataset.postName||"",this.likeCount=parseInt(t.dataset.upvoteCount||"0"),this.checkLikeStatus())},checkLikeStatus(){if(!this.postName)return;const t=JSON.parse(localStorage.getItem("halo.upvoted.post.names")||"[]");this.isLiked=t.includes(this.postName)},async toggleLike(){if(this.postName&&!this.isLiked)try{const t=await fetch("/apis/api.halo.run/v1alpha1/trackers/upvote",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group:"content.halo.run",plural:"posts",name:this.postName})});if(t.ok){this.isLiked=!0,this.likeCount+=1;const t=JSON.parse(localStorage.getItem("halo.upvoted.post.names")||"[]");t.includes(this.postName)||(t.push(this.postName),localStorage.setItem("halo.upvoted.post.names",JSON.stringify(t)))}else{await t.text()}}catch(t){}}})),Alpine.data("postComment",()=>({commentCount:0,init(){const t=this.$el.closest("[data-comment-count]");t&&(this.commentCount=parseInt(t.dataset.commentCount||"0"))},toggleCommentDrawer(){const t=document.getElementById("comment-drawer");t&&(t.checked=!t.checked)}}))}),function(){const i={init(){this.initWordCount(),this.initHeadingAnchors(),this.initTOC(),this.initReadingProgress(),this.initCodeCopy(),this.initScrollToTop(),this.initTocDrawer()},initTocDrawer(){const t=document.getElementById("post-toc-overlay"),e=document.getElementById("post-toc-drawer"),n=document.getElementById("post-toc-drawer-nav");t&&e&&(window.openPostTocDrawer=()=>{t.classList.add("open"),e.classList.add("open"),document.body.style.overflow="hidden",n&&!n.querySelector(".toc-list")&&this.initTocDrawerContent(n)},window.closePostTocDrawer=()=>{t.classList.remove("open"),e.classList.remove("open"),document.body.style.overflow=""},document.addEventListener("keydown",t=>{"Escape"===t.key&&e.classList.contains("open")&&window.closePostTocDrawer()}))},initTocDrawerContent(t){const e=document.getElementById("toc-nav");if(e&&e.innerHTML.trim())return t.innerHTML=e.innerHTML,void this.bindTocDrawerEvents(t);const n=document.getElementById("article-content");if(!n)return void(t.innerHTML='<p class="text-base-content/50 text-sm">暂无目录</p>');const o=n.querySelectorAll("h1, h2, h3, h4, h5, h6");if(0===o.length)return void(t.innerHTML='<p class="text-base-content/50 text-sm">暂无目录</p>');const i=Array.from(o),s=i.map(t=>parseInt(t.tagName.charAt(1))),c=Math.min(...s),a=document.createElement("ol");a.className="toc-list",i.forEach((t,e)=>{t.id||(t.id=`heading-${e}`);const n=parseInt(t.tagName.charAt(1))-c,o=document.createElement("li");o.className="toc-item-wrapper",o.style.setProperty("--toc-indent-multiplier",n.toString());const i=document.createElement("a");i.href=`#${t.id}`,i.textContent=t.textContent.trim(),i.className="toc-link",i.setAttribute("data-heading-id",t.id),o.appendChild(i),a.appendChild(o)}),t.appendChild(a),this.bindTocDrawerEvents(t)},bindTocDrawerEvents(t){t.querySelectorAll(".toc-link").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();const n=t.getAttribute("data-heading-id")||t.getAttribute("href").slice(1),o=document.getElementById(n);o&&(window.closePostTocDrawer(),setTimeout(()=>{window.scrollTo({top:o.offsetTop-80,behavior:"smooth"})},100))})})},initHeadingAnchors(){const t=document.getElementById("article-content");if(!t)return;t.querySelectorAll("h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]").forEach(t=>{const e=t.getAttribute("id");if(!e)return;t.style.position="relative",t.style.cursor="pointer";const n=document.createElement("a");n.href=`#${e}`,n.className="heading-anchor",n.innerHTML='<span class="icon-[heroicons--link] w-4 h-4"></span>',n.setAttribute("aria-label","复制链接"),n.style.cssText="\n                    position: absolute;\n                    left: -1.5em;\n                    top: 50%;\n                    transform: translateY(-50%);\n                    opacity: 0;\n                    transition: opacity 0.2s ease;\n                    color: var(--color-primary);\n                    text-decoration: none;\n                    display: inline-flex;\n                    align-items: center;\n                ",t.addEventListener("mouseenter",()=>{n.style.opacity="1"}),t.addEventListener("mouseleave",()=>{n.style.opacity="0"}),n.addEventListener("click",async t=>{t.preventDefault();const o=window.location.origin+window.location.pathname+`#${e}`;try{await navigator.clipboard.writeText(o),n.innerHTML='<span class="icon-[heroicons--check] w-4 h-4"></span>',setTimeout(()=>{n.innerHTML='<span class="icon-[heroicons--link] w-4 h-4"></span>'},2e3)}catch(i){}}),t.insertBefore(n,t.firstChild)})},initTOC(){const i=document.getElementById("toc-nav"),s=document.getElementById("toc-card");if(!i)return;const c=document.getElementById("article-content");if(!c)return void(s&&(s.style.display="none"));const a=c.querySelectorAll("h1, h2, h3, h4, h5, h6");if(0===a.length)return void(s&&(s.style.display="none"));const r=t(a);if(0===r.filteredHeadings.length)return void(s&&(s.style.display="none"));s&&(s.style.display="block");const l=e(r.filteredHeadings,r.minLevel),d=n(l,{addTooltip:!0,onClick:t=>o(t,80)});i.innerHTML="",i.appendChild(d),this.initTocScrollHighlight(r.filteredHeadings),this.initAdaptiveLayout()},initAdaptiveLayout(){if(document.querySelector(".toc-container")){if(window.ResizeObserver){new ResizeObserver(()=>{this.updateTocLayout()}).observe(document.documentElement)}window.addEventListener("resize",()=>{clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{this.updateTocLayout()},150)}),this.updateTocLayout()}},updateTocLayout(){const t=document.querySelector(".toc-container");if(!t)return;const e=document.getElementById("toc-nav");if(!e)return;const n=e.scrollHeight>parseFloat(getComputedStyle(t).maxHeight);t.classList.toggle("has-scroll",n)},initTocScrollHighlight(t){let e=!1;const n=()=>{const n=window.scrollY+120,o=window.innerHeight,i=document.documentElement.scrollHeight;let s=-1;n+o>=i-50?s=t.length-1:t.forEach((e,o)=>{const c=e.offsetTop,a=t[o+1],r=a?a.offsetTop:i;c<=n&&n<r&&(s=o)}),this.updateTocHighlight(s),e=!1};window.addEventListener("scroll",()=>{e||(requestAnimationFrame(n),e=!0)},{passive:!0}),n()},updateTocHighlight(t){document.querySelectorAll(".toc-link").forEach((e,n)=>{if(n===t){e.classList.add("active");const t=document.querySelector(".toc-container");t&&this.scrollToActiveItem(t,e)}else e.classList.remove("active")})},scrollToActiveItem(t,e){const n=t.scrollTop,o=t.clientHeight,i=t.scrollHeight;let s=0,c=e;for(;c&&c!==t&&(s+=c.offsetTop,c=c.offsetParent,c!==t););if(c!==t){const n=t.getBoundingClientRect().top+window.scrollY;s=e.getBoundingClientRect().top+window.scrollY-n+t.scrollTop}const a=e.offsetHeight,r=n,l=n+o,d=s,h=s+a;if(!(d>=r&&h<=l)){let e;const n=Math.max(0,i-o),c=0,m=o/2-a/2;if(e=s-m,e<c)e=s<o/3?c:Math.max(c,s-40);else if(e>n){e=i-s-a<o/3?n:Math.min(n,s-o+a+40)}if(h<r){e=r-h>o?Math.max(c,s-m):Math.max(c,s-20)}else if(d>l){e=d-l>o?Math.min(n,s-m):Math.min(n,s-o+a+20)}const u=t.scrollTop,p=Math.abs(e-u);if(p>5){const n=p>o?"auto":"smooth";t.scrollTo({top:e,behavior:n})}}},initReadingProgress(){const t=document.getElementById("reading-progress");if(!t)return;let e=!1;const n=()=>{const n=document.documentElement.scrollHeight-window.innerHeight,o=window.scrollY/n*100;t.style.width=`${Math.min(o,100)}%`,e=!1};window.addEventListener("scroll",()=>{e||(requestAnimationFrame(n),e=!0)},{passive:!0})},initCodeCopy(){document.querySelectorAll("pre code").forEach(t=>{const e=t.parentElement;if(!e)return;const n=document.createElement("button");n.className="absolute top-2 right-2 px-3 py-1 bg-base-200 hover:bg-base-300 rounded text-sm transition-colors",n.textContent="复制",n.setAttribute("aria-label","复制代码"),e.style.position="relative",e.appendChild(n),n.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(t.textContent),n.textContent="已复制",n.classList.add("bg-success","text-success-content"),setTimeout(()=>{n.textContent="复制",n.classList.remove("bg-success","text-success-content")},2e3)}catch(e){n.textContent="复制失败",setTimeout(()=>{n.textContent="复制"},2e3)}})})},initWordCount(){const t=document.getElementById("article-content"),e=document.getElementById("word-count"),n=document.getElementById("reading-time");if(!t||!e||!n)return;const o=t.cloneNode(!0);o.querySelectorAll("pre").forEach(t=>t.remove());const i=o.textContent||o.innerText||"",s=(i.match(/[\u4e00-\u9fa5]/g)||[]).length,c=(i.replace(/[\u4e00-\u9fa5]/g," ").match(/[a-zA-Z]+/g)||[]).length,a=s+c,r=Math.ceil(s/300+c/200);e.textContent=a.toLocaleString(),n.textContent=Math.max(1,r)},initScrollToTop(){const t=document.getElementById("scroll-to-top");if(!t)return;let e=!1;const n=()=>{window.scrollY>300?(t.classList.remove("opacity-0","pointer-events-none"),t.classList.add("opacity-100")):(t.classList.add("opacity-0","pointer-events-none"),t.classList.remove("opacity-100")),e=!1};window.addEventListener("scroll",()=>{e||(requestAnimationFrame(n),e=!0)},{passive:!0}),t.addEventListener("click",()=>{"scrollBehavior"in document.documentElement.style?window.scrollTo({top:0,behavior:"smooth"}):window.scrollTo(0,0)})}};document.addEventListener("DOMContentLoaded",()=>{i.init()})}();
